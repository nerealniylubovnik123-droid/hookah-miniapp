<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–∞–ª—å—è–Ω–Ω—ã–π –ú–∏–∫—Å–µ—Ä ‚Äî Enhanced Stable</title>
  <style>
    :root{
      --bg:#000;
      --panel:#0c0c0c;
      --panel-2:#151515;
      --border:#242424;
      --text:#fff;
      --muted:#f0e9db;
      --accent:#f0b85a;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter, system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .container{max-width:420px;margin:0 auto;padding:16px;display:grid;gap:16px}
    header.title{font-weight:700;text-align:center;color:var(--muted);font-size:20px}
    .tabs{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;background:var(--panel-2);padding:6px;border-radius:14px}
    .tab-btn{background:transparent;border:none;color:#fff;padding:10px 12px;border-radius:10px;cursor:pointer;transition:.15s transform,.2s background,.2s color}
    .tab-btn:hover{transform:translateY(-1px)}
    .tab-btn:active{transform:translateY(0) scale(.98)}
    .tab-btn.active{background:var(--accent);color:#000}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px}
    .card .hd{padding:14px 14px 0 14px}
    .card .hd h3{margin:0 0 2px 0;font-size:18px}
    .card .hd .desc{margin:0 0 10px 0;font-size:12px;color:rgba(240,233,219,.7)}
    .card .bd{padding:12px 14px 14px 14px}
    .btn{background:#1f1f1f;border:1px solid #2a2a2a;color:#fff;border-radius:10px;padding:8px 10px;cursor:pointer;transition:.15s transform,.2s background,.2s color,.2s border}
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0) scale(.98)}
    .btn.accent{background:var(--accent);color:#000;border-color:var(--accent)}
    .btn.small{padding:4px 8px;font-size:12px;border-radius:8px}
    .btn.ghost{background:transparent;border-color:#2a2a2a}
    .btn.danger{background:#3a0d0d;border-color:#5a1a1a;color:#ffbaba}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .grid{display:grid;gap:8px}
    .brand-btn{background:var(--panel-2);border:1px solid var(--border);border-radius:12px;padding:12px;color:var(--text);cursor:pointer;transition:.15s transform,.2s background,.2s color,.2s border;text-align:center}
    .brand-btn:hover{transform:translateY(-1px)}
    .brand-btn:active{transform:translateY(0) scale(.98)}
    .brand-btn.active{background:var(--accent);border-color:var(--accent);color:#000}
    .row{display:flex;gap:8px;align-items:center}
    .row.between{justify-content:space-between}
    .space{height:8px}
    .input{width:100%;background:var(--panel-2);border:1px solid var(--border);color:#fff;border-radius:10px;padding:10px}
    .mix-card{background:var(--panel-2);border:1px solid var(--border);border-radius:12px;padding:10px}
    .tiny{font-size:11px}
    .muted{opacity:.75}
    .sep{height:1px;background:var(--border);margin:8px 0}
    .taste-line{font-size:13px;opacity:.92}
    .flavor-item{display:flex;justify-content:space-between;align-items:center;background:var(--panel-2);border:1px solid var(--border);border-radius:12px;padding:10px}
    input[type=range]{width:100%;accent-color:var(--accent)}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border-radius:999px;border:1px solid var(--border);background:var(--panel-2);font-size:11px}
    .badge.hidden{border-color:#503333;background:#2a1a1a;color:#ffbaba}
    .badge.ok{border-color:#2c4737;background:#16271d;color:#bff5d6}
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.development.js">
// --- Telegram Diagnostic Overlay ---
(function(){
  function showDiag(info){
    const box=document.createElement('div');
    box.style.position='fixed';
    box.style.top='50%';
    box.style.left='50%';
    box.style.transform='translate(-50%,-50%)';
    box.style.background='rgba(0,0,0,0.9)';
    box.style.color='white';
    box.style.padding='16px 24px';
    box.style.border='1px solid #f0b85a';
    box.style.borderRadius='12px';
    box.style.fontSize='14px';
    box.style.textAlign='left';
    box.style.zIndex='99999';
    box.style.whiteSpace='pre-line';
    box.innerText='üîç Telegram Debug Info
'+info;
    document.body.appendChild(box);
    setTimeout(()=>box.remove(),3000);
  }
  const info=[
    'ID: '+(window.CURRENT_USER_ID||0),
    'Username: '+(window.CURRENT_USERNAME||'-'),
    'Name: '+(window.CURRENT_USER_NAME||'-'),
    'isAdmin: '+(window.IS_ADMIN||false),
    'initData: '+(window.Telegram?.WebApp?.initData?'ok':'–ø—É—Å—Ç–æ')
  ].join('
');
  if(document.readyState!=='loading') showDiag(info);
  else document.addEventListener('DOMContentLoaded',()=>showDiag(info));
})();
// --- End Diagnostic Overlay ---
</script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
  <script type="text/babel" data-presets="react">
    const {useState,useMemo,useEffect} = React;

// --- Telegram User & Admin (username + ID) ---
var tg = window.Telegram?.WebApp || null;
var CURRENT_USER_ID = 0;
var CURRENT_USER_NAME = "–ì–æ—Å—Ç—å";
var CURRENT_USERNAME = "";
const ADMIN_USERNAMES = ["tutenhaman"]; // üëà Telegram usernames –±–µ–∑ @
const ADMIN_IDS = [504348666]; // üëà Telegram user IDs

// –ü–æ–ø—ã—Ç–∫–∞ —Å—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ Telegram WebApp
try {
  if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
    const u = tg.initDataUnsafe.user;
    CURRENT_USER_ID = u.id || 0;
    CURRENT_USERNAME = (u.username || "").toLowerCase();
    CURRENT_USER_NAME = [u.first_name, u.last_name].filter(Boolean).join(" ") || "–ì–æ—Å—Ç—å";
  }
} catch (e) {
  console.warn("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è Telegram WebApp –¥–∞–Ω–Ω—ã—Ö:", e);
}

// –†–µ–∂–∏–º –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ ‚Äî —Ç–æ–ª—å–∫–æ localhost / file://
if (!CURRENT_USERNAME && (location.hostname === "localhost" || location.protocol === "file:")) {
  CURRENT_USERNAME = "tutenhaman";
  CURRENT_USER_ID = 504348666;
  CURRENT_USER_NAME = "Admin (offline)";
  console.log("Offline test mode: admin =", CURRENT_USERNAME);
}

// –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
var IS_ADMIN = false;
if ((CURRENT_USERNAME && ADMIN_USERNAMES.includes(CURRENT_USERNAME)) || ADMIN_IDS.includes(CURRENT_USER_ID)) {
  IS_ADMIN = true;
}

console.log("Telegram user:", CURRENT_USERNAME, "| ID:", CURRENT_USER_ID, "| Admin:", IS_ADMIN);
// -------------------------------------------------------------


      const load=(k,f)=>{try{const r=localStorage.getItem(k);return r?JSON.parse(r):f}catch{return f}};
    const save=(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}};
    const slug=s=>s.toLowerCase().trim().split(' ').filter(Boolean).join('-').normalize('NFKD').replace(/[^a-z–∞-—è0-9-]/gi,'');
    const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
    const calcAvg=ps=>Math.round(ps.reduce((a,b)=>a+b.percent*b.strength,0)/ps.reduce((a,b)=>a+b.percent,0));
    const useDebouncedValue=(value,delay=220)=>{const [v,setV]=useState(value);useEffect(()=>{const id=setTimeout(()=>setV(value),delay);return()=>clearTimeout(id)},[value,delay]);return v};
    function smartDesc(parts){
      if(!parts.length)return"";
      const s=[...parts].sort((a,b)=>b.percent-a.percent);
      const base=s.slice(0,2).map(t=>t.taste.split(",").map(x=>x.trim()).join(" + ")).join(" –∏ ");
      const acc=s.slice(2,4); const accStr=acc.length?(" —Å –æ—Ç—Ç–µ–Ω–∫–∞–º–∏ "+acc.map(t=>t.taste.split(",").map(x=>x.trim()).join(" + ")).join(" –∏ ")):"";
      const avg=Math.round(s.reduce((a,x)=>a+x.strength*x.percent,0)/s.reduce((a,x)=>a+x.percent,0));
      const tone=avg>=7?"–Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π":avg>=5?"–≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–π":avg>=3?"–º—è–≥–∫–∏–π":"–ª—ë–≥–∫–∏–π";
      return `${tone} –º–∏–∫—Å: ${base}${accStr}`;
    }
    function App(){
      const [tab,setTab]=useState('community');

      const seed=[
        {id:"alfakher",name:"Al Fakher",hidden:false,flavors:[
          {id:"mint",name:"Mint",strength:2,taste:"—Å–≤–µ–∂–∏–π, –º—è—Ç–Ω—ã–π",hidden:false},
          {id:"grape",name:"Grape",strength:2,taste:"—Ñ—Ä—É–∫—Ç–æ–≤—ã–π, –≤–∏–Ω–æ–≥—Ä–∞–¥–Ω—ã–π",hidden:false},
          {id:"double-apple",name:"Double Apple",strength:3,taste:"–∞–Ω–∏—Å–æ–≤—ã–π, —è–±–ª–æ—á–Ω—ã–π",hidden:false}
        ]},
        {id:"musthave",name:"Must Have",hidden:false,flavors:[
          {id:"raspberry",name:"Raspberry",strength:3,taste:"—è–≥–æ–¥–Ω—ã–π, –∫–∏—Å–ª–æ–≤–∞—Ç—ã–π",hidden:false},
          {id:"cheesecake",name:"Cheesecake",strength:4,taste:"–¥–µ—Å–µ—Ä—Ç–Ω—ã–π, —Å–ª–∏–≤–æ—á–Ω—ã–π",hidden:false},
          {id:"whiskey-cola",name:"Whiskey Cola",strength:5,taste:"–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π, –∫–æ–ª–∞",hidden:false}
        ]},
        {id:"darkside",name:"Darkside",hidden:false,flavors:[
          {id:"pear",name:"Pear",strength:5,taste:"–≥—Ä—É—à–µ–≤—ã–π, —Å–æ—á–Ω—ã–π",hidden:false},
          {id:"cola",name:"Cola",strength:5,taste:"–∫–∞—Ä–∞–º–µ–ª—å–Ω—ã–π",hidden:false},
          {id:"spiced-rum",name:"Spiced Rum",strength:7,taste:"–ø—Ä—è–Ω—ã–π, –∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π",hidden:false}
        ]}
      ];
      const [brands,setBrands]=useState(()=>load("h.brands.v3",seed));
      const [banned,setBanned]=useState(()=>load("h.banned",[]));
      const [mixes,setMixes]=useState(()=>load("h.mixes.v3",[]));
      useEffect(()=>save("h.brands.v3",brands),[brands]);useEffect(()=>save("h.banned",banned),[banned]);useEffect(()=>save("h.mixes.v3",mixes),[mixes]);
      useEffect(()=>{if(mixes.length===0){const m1=[
        {key:"musthave:raspberry",brandId:"musthave",flavorId:"raspberry",name:"Raspberry",percent:60,strength:3,taste:"—è–≥–æ–¥–Ω—ã–π, –∫–∏—Å–ª–æ–≤–∞—Ç—ã–π"},
        {key:"alfakher:mint",brandId:"alfakher",flavorId:"mint",name:"Mint",percent:40,strength:2,taste:"—Å–≤–µ–∂–∏–π, –º—è—Ç–Ω—ã–π"}
      ];const m2=[
        {key:"alfakher:double-apple",brandId:"alfakher",flavorId:"double-apple",name:"Double Apple",percent:50,strength:3,taste:"–∞–Ω–∏—Å–æ–≤—ã–π, —è–±–ª–æ—á–Ω—ã–π"},
        {key:"darkside:spiced-rum",brandId:"darkside",flavorId:"spiced-rum",name:"Spiced Rum",percent:50,strength:7,taste:"–ø—Ä—è–Ω—ã–π, –∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π"}
      ];setMixes([{id:"ex1",title:"–õ–µ—Å–Ω—ã–µ —è–≥–æ–¥—ã",author:"–ì–æ—Å—Ç—å –ê–Ω—è",parts:m1,avgStrength:calcAvg(m1),likes:0,createdAt:Date.now(), author: CURRENT_USER_NAME },{id:"ex2",title:"–Ø–±–ª–æ—á–Ω—ã–π –ø—Ä—è–Ω—ã–π",author:"–ì–æ—Å—Ç—å –ú–∞–∫—Å",parts:m2,avgStrength:calcAvg(m2),likes:0,createdAt:Date.now(), author: CURRENT_USER_NAME }])}},[]);

      // community
      const DIR=["–¥–µ—Å–µ—Ä—Ç–Ω—ã–π","–∫–∏—Å–ª—ã–π","—Ç—Ä–∞–≤—è–Ω–æ–π","–ø—Ä—è–Ω—ã–π","—á–∞–π–Ω—ã–π","—Å–ª–∞–¥–∫–∏–π","—Å–≤–µ–∂–∏–π","–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π","–≥–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π"];
      const [pref,setPref]=useState('all'); const [strength,setStrength]=useState(5); const [likes,setLikes]=useState({});
      const rec=mixes.filter(m=>pref==='all'||m.parts.some(p=>p.taste.toLowerCase().includes(pref))).filter(m=>Math.abs(m.avgStrength-strength)<=1);
      const toggleLike=id=>{setMixes(ms=>ms.map(m=>m.id===id?{...m,likes:m.likes+(likes[id]?-1:1)}:m));setLikes(s=>{const n={...s};if(n[id])delete n[id];else n[id]=1;return n})};

      // builder
      const [selected,setSelected]=useState(null);
      const [search,setSearch]=useState(""); const searchDeb=useDebouncedValue(search,220);
      const [parts,setParts]=useState([]);
      const selectedBrand=useMemo(()=>brands.find(b=>b.id===selected)||null,[selected,brands]);
      const total=parts.reduce((a,b)=>a+b.percent,0);
      const avg=parts.length&&total>0?Math.round(parts.reduce((a,p)=>a+p.percent*p.strength,0)/total):0;
      const remaining=Math.max(0,100-total);
      const visibleBrands=brands.filter(b=>!b.hidden);
      const filtered=selectedBrand?selectedBrand.flavors.filter(f=>!f.hidden).filter(f=>{
        const q=searchDeb.toLowerCase();return f.name.toLowerCase().includes(q)||f.taste.toLowerCase().includes(q);
      }):[];
      const addFlavor=(brandId,fl)=>{if(remaining<=0)return;const key=`${brandId}:${fl.id}`;setParts(prev=>{if(prev.some(p=>p.key===key))return prev;const defPct=Math.min(10,Math.max(0,100-prev.reduce((a,b)=>a+b.percent,0)));if(defPct<=0)return prev;return[...prev,{key,brandId,flavorId:fl.id,name:fl.name,taste:fl.taste,strength:fl.strength,percent:defPct}]})};
      const updatePct=(key,val)=>{setParts(prev=>{const sumOthers=prev.reduce((a,b)=>a+(b.key===key?0:b.percent),0);const allowed=Math.max(0,100-sumOthers);const clamped=clamp(Math.round(val),0,allowed);return prev.map(x=>x.key===key?{...x,percent:clamped}:x)})};
      const removePart=key=>setParts(prev=>prev.filter(x=>x.key!==key));
      const saveMix=()=>{if(total!==100)return;const id="mix-"+Date.now();setMixes(prev=>[{id,title:"–ú–∏–∫—Å",description:"",parts,avgStrength:avg,likes:0,createdAt:Date.now(),author:"–ì–æ—Å—Ç—å"},...prev]);setParts([])};

      // global search
      const [gq,setGq]=useState(""); const gqd=useDebouncedValue(gq,220);
      const gresults=useMemo(()=>{const q=gqd.trim().toLowerCase();if(!q)return[];return brands.filter(b=>!b.hidden).map(b=>({brand:b,flavors:b.flavors.filter(f=>!f.hidden).filter(f=>f.name.toLowerCase().includes(q)||f.taste.toLowerCase().includes(q))})).filter(g=>g.flavors.length>0)},[gqd,brands]);

      // admin
      const [brandName,setBrandName]=useState(""); const [brandForFlavor,setBrandForFlavor]=useState((brands[0] && brands[0].id)||"");
      const [flavorName,setFlavorName]=useState(""); const [flavorStrength,setFlavorStrength]=useState(5); const [flavorTaste,setFlavorTaste]=useState("");
      const [banInput,setBanInput]=useState("");
      const addBrand=()=>{const name=brandName.trim();if(!name)return;const id=slug(name);if(brands.some(b=>b.id===id))return;const next=[...brands,{id,name,hidden:false,flavors:[]}];setBrands(next);setBrandName("");if(!brandForFlavor)setBrandForFlavor(id)};
      const addFlavorAdmin=()=>{const b=brands.find(x=>x.id===brandForFlavor);if(!b)return;const name=flavorName.trim();if(!name)return;const id=slug(name);if(b.flavors.some(f=>f.id===id))return;const st=clamp(Math.round(flavorStrength),1,10);const fl={id,name,strength:st,taste:flavorTaste.trim(),hidden:false};setBrands(brands.map(x=>x.id===b.id?{...x,flavors:[...x.flavors,fl]}:x))};
      const toggleBrandHidden=id=>setBrands(prev=>prev.map(b=>b.id===id?{...b,hidden:!b.hidden}:b));
      const toggleFlavorHidden=(bid,fid)=>setBrands(prev=>prev.map(b=>b.id===bid?{...b,flavors:b.flavors.map(f=>f.id===fid?{...f,hidden:!f.hidden}:f)}:b));
      const delBrand=id=>{const next=brands.filter(b=>b.id!==id);setBrands(next);if(brandForFlavor===id)setBrandForFlavor(next[0]?.id||"");if(selected===id)setSelected(null)};
      const delFlavor=(bid,fid)=>setBrands(prev=>prev.map(b=>b.id!==bid?b:{...b,flavors:b.flavors.filter(f=>f.id!==fid)}));
      const addBan=()=>{const w=banInput.trim().toLowerCase();if(!w)return;if(banned.includes(w))return;setBanned([...banned,w])};
      const delBan=w=>setBanned(banned.filter(x=>x!==w));

      return <div className="container">
        <header className="title">–ö–∞–ª—å—è–Ω–Ω—ã–π –ú–∏–∫—Å–µ—Ä</header>
        <div className="tabs">
  <button className={"tab-btn"+(tab==='community'?' active':'')} onClick={()=>setTab('community')}>–ú–∏–∫—Å—ã</button>
  <button className={"tab-btn"+(tab==='builder'?' active':'')} onClick={()=>setTab('builder')}>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</button>
  {IS_ADMIN && <button className={"tab-btn"+(tab==='admin'?' active':'')} onClick={()=>setTab('admin')}>–ê–¥–º–∏–Ω</button>}
</div>

        {tab==='community'&&<div className="card"><div className="hd"><h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3><p className="desc">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –∫—Ä–µ–ø–æ—Å—Ç—å</p></div><div className="bd">
          <div className="grid-2"><button className={"btn "+(pref==='all'?'accent':'')} onClick={()=>setPref('all')}>–í—Å–µ</button>{["–¥–µ—Å–µ—Ä—Ç–Ω—ã–π","–∫–∏—Å–ª—ã–π","—Ç—Ä–∞–≤—è–Ω–æ–π","–ø—Ä—è–Ω—ã–π","—á–∞–π–Ω—ã–π","—Å–ª–∞–¥–∫–∏–π","—Å–≤–µ–∂–∏–π","–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–π","–≥–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π"].map(t=><button key={t} className={"btn "+(pref===t?'accent':'')} onClick={()=>setPref(t)}>{t}</button>)}</div>
          <div className="space"></div><div>–ö—Ä–µ–ø–æ—Å—Ç—å: <b>{strength}</b></div><input type="range" min="1" max="10" value={strength} onChange={e=>setStrength(parseInt(e.target.value))}/>
          <div className="sep"></div>
          <div className="grid">{rec.map(m=><div key={m.id} className="mix-card"><div className="row between"><div><div style={{fontWeight:600}}>{m.title}</div><div className="tiny muted">–ú–∏–∫—Å –æ—Ç {m.author}</div></div><button className={"btn "+(likes[m.id]?'accent':'')} onClick={()=>toggleLike(m.id)}>‚ù§ {m.likes}</button></div><div className="space"></div><div className="tiny">–ö—Ä–µ–ø–æ—Å—Ç—å: <b>{m.avgStrength}</b></div><div className="taste-line">{smartDesc(m.parts)}</div><div className="tiny muted">–°–æ—Å—Ç–∞–≤: {m.parts.map(p=>p.name+" "+p.percent+"%").join(' + ')}</div></div>)}</div>
        </div></div>}

        {tab==='builder'&&<>
          <div className="card"><div className="hd"><h3>–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫</h3><p className="desc">–ò—â–µ—Ç –ø–æ –≤—Å–µ–º –±—Ä–µ–Ω–¥–∞–º, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ</p></div><div className="bd">
            <input className="input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –≤–∫—É—Å–∞–º..." value={gq} onChange={e=>setGq(e.target.value)}/>
            <div className="space"></div>
            <div className="grid">{gqd&&gresults.length===0&&<div className="tiny muted">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>}{gresults.map(g=><div key={g.brand.id} className="mix-card"><div className="row between"><div><b>{g.brand.name}</b></div>{g.brand.hidden?<span className="badge hidden">—Å–∫—Ä—ã—Ç</span>:<span className="badge ok">–¥–æ—Å—Ç—É–ø–µ–Ω</span>}</div><div className="space"></div><div className="grid">{g.flavors.map(f=><div key={f.id} className="flavor-item"><div><div style={{fontWeight:600}}>{f.name}</div><div className="tiny muted">–∫—Ä–µ–ø–æ—Å—Ç—å: {f.strength} ‚Ä¢ –≤–∫—É—Å: {f.taste}</div></div><button className="btn" onClick={()=>addFlavor(g.brand.id,f)}>+ –≤ –º–∏–∫—Å</button></div>)}</div></div>)}</div>
          </div></div>

          <div className="card"><div className="hd"><h3>–ë—Ä–µ–Ω–¥—ã</h3><p className="desc">–í—ã–±–æ—Ä –±—Ä–µ–Ω–¥–∞</p></div><div className="bd"><div className="grid-2">{visibleBrands.map(b=><button key={b.id} className={"brand-btn"+(selected===b.id?' active':'')} onClick={()=>setSelected(b.id)}>{b.name}</button>)}</div></div></div>

          {selectedBrand&&<div className="card"><div className="hd"><h3>–í–∫—É—Å—ã ‚Äî {selectedBrand.name}</h3></div><div className="bd"><input className="input" placeholder="–ü–æ–∏—Å–∫ –≤ –±—Ä–µ–Ω–¥–µ..." value={search} onChange={e=>setSearch(e.target.value)}/><div className="space"></div><div className="grid">{filtered.map(f=><div key={f.id} className="flavor-item"><div><div style={{fontWeight:600}}>{f.name}</div><div className="tiny muted">–∫—Ä–µ–ø–æ—Å—Ç—å: {f.strength} ‚Ä¢ –≤–∫—É—Å: {f.taste}</div></div><button className="btn" onClick={()=>addFlavor(selectedBrand.id,f)}>+ –≤ –º–∏–∫—Å</button></div>)}</div></div></div>}

          <div className="card"><div className="hd"><h3>–í–∞—à –º–∏–∫—Å</h3><p className="desc">–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 100%.</p></div><div className="bd">
            {parts.length===0&&<div className="tiny muted">–î–æ–±–∞–≤—å—Ç–µ –≤–∫—É—Å—ã –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ.</div>}
            <div className="grid">{parts.map(p=><div key={p.key} className="mix-card"><div className="row between"><div><div style={{fontWeight:600}}>{p.name}</div><div className="tiny muted">–∫—Ä–µ–ø–æ—Å—Ç—å: {p.strength} ‚Ä¢ –≤–∫—É—Å: {p.taste}</div></div><button className="btn" onClick={()=>removePart(p.key)}>—É–¥–∞–ª–∏—Ç—å</button></div><div className="space"></div><input type="range" min="0" max="100" step="5" value={p.percent} onChange={e=>updatePct(p.key,parseInt(e.target.value))}/><div className="row between tiny muted"><span>0%</span><span>{p.percent}%</span><span>100%</span></div></div>)}</div>
            <div className="sep"></div><div className="row between"><div>–°—É–º–º–∞: <b>{total}%</b> (–æ—Å—Ç–∞–ª–æ—Å—å: <b>{Math.max(0,100-total)}%</b>)</div><div className="muted">–∫—Ä–µ–ø–æ—Å—Ç—å: <b>{avg||0}</b></div></div>
            <div className="space"></div><div className="row" style={{justifyContent:'flex-end'}}><button className="btn accent" onClick={saveMix}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–∏–∫—Å</button></div>
          </div></div>

          <div className="card"><div className="hd"><h3>–ò—Ç–æ–≥–æ–≤—ã–π –≤–∫—É—Å</h3><p className="desc">–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</p></div><div className="bd">{parts.length===0?<div className="muted">–ï—â—ë –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤–∫—É—Å–æ–≤.</div>:<div className="taste-line">{smartDesc(parts)}</div>}</div></div>
        </>}

        {IS_ADMIN && tab==='admin'&&<>
          <div className="card"><div className="hd"><h3>–ë—Ä–µ–Ω–¥—ã</h3><p className="desc">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ / —Å–∫—Ä—ã—Ç–∏–µ / —É–¥–∞–ª–µ–Ω–∏–µ</p></div><div className="bd">
            <div className="row"><input className="input" placeholder="–ù–æ–≤—ã–π –±—Ä–µ–Ω–¥" value={brandName} onChange={e=>setBrandName(e.target.value)}/><button className="btn" onClick={addBrand}>–î–æ–±–∞–≤–∏—Ç—å</button></div>
            <div className="space"></div>
            <div className="grid-2">{brands.map(b=><div key={b.id} className="mix-card"><div className="row between">
              <div><div style={{fontWeight:600}}>{b.name}</div><div className="tiny muted">–≤–∫—É—Å–æ–≤: {b.flavors.length}</div>{b.hidden?<div className="badge hidden">—Å–∫—Ä—ã—Ç</div>:<div className="badge ok">–¥–æ—Å—Ç—É–ø–µ–Ω</div>}</div>
              <div className="grid"><button className="btn small ghost" onClick={()=>toggleBrandHidden(b.id)}>{b.hidden?"–ø–æ–∫–∞–∑–∞—Ç—å":"—Å–∫—Ä—ã—Ç—å"}</button><button className="btn small danger" onClick={()=>delBrand(b.id)}>—É–¥–∞–ª–∏—Ç—å</button></div>
            </div></div>)}</div>
          </div></div>

          <div className="card"><div className="hd"><h3>–í–∫—É—Å—ã</h3><p className="desc">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ / —Å–∫—Ä—ã—Ç–∏–µ / —É–¥–∞–ª–µ–Ω–∏–µ</p></div><div className="bd">
            <div className="grid-2"><select className="input" value={brandForFlavor} onChange={e=>setBrandForFlavor(e.target.value)}>{brands.map(b=><option key={b.id} value={b.id}>{b.name}</option>)}</select><input className="input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∫—É—Å–∞" value={flavorName} onChange={e=>setFlavorName(e.target.value)}/></div>
            <div className="space"></div>
            <div className="row between"><div>–ö—Ä–µ–ø–æ—Å—Ç—å: <b>{flavorStrength}</b></div><input type="range" min="1" max="10" value={flavorStrength} onChange={e=>setFlavorStrength(parseInt(e.target.value))}/></div>
            <div className="space"></div>
            <input className="input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≤–∫—É—Å–∞ (–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è)" value={flavorTaste} onChange={e=>setFlavorTaste(e.target.value)}/>
            <div className="space"></div>
            <div className="row" style={{justifyContent:'flex-end'}}><button className="btn" onClick={addFlavorAdmin}>–î–æ–±–∞–≤–∏—Ç—å –≤–∫—É—Å</button></div>
            {brands.find(b=>b.id===brandForFlavor)&&<><div className="sep"></div><div className="muted">–í–∫—É—Å—ã –±—Ä–µ–Ω–¥–∞: {brands.find(b=>b.id===brandForFlavor).name}</div><div className="space"></div><div className="grid">{brands.find(b=>b.id===brandForFlavor).flavors.map(f=><div key={f.id} className="flavor-item"><div><div style={{fontWeight:600}}>{f.name}</div><div className="tiny muted">–∫—Ä–µ–ø–æ—Å—Ç—å: {f.strength} ‚Ä¢ –≤–∫—É—Å: {f.taste}</div>{f.hidden&&<div className="badge hidden">—Å–∫—Ä—ã—Ç</div>}</div><div className="row"><button className="btn small ghost" onClick={()=>toggleFlavorHidden(brandForFlavor,f.id)}>{f.hidden?"–ø–æ–∫–∞–∑–∞—Ç—å":"—Å–∫—Ä—ã—Ç—å"}</button><button className="btn small danger" onClick={()=>delFlavor(brandForFlavor,f.id)}>—É–¥–∞–ª–∏—Ç—å</button></div></div>)}</div></>}
          </div></div>

          <div className="card"><div className="hd"><h3>–ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Å–ª–æ–≤–∞</h3></div><div className="bd">
            <div className="row"><input className="input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 18+" value={banInput} onChange={e=>setBanInput(e.target.value)}/><button className="btn" onClick={addBan}>–î–æ–±–∞–≤–∏—Ç—å</button></div>
            <div className="space"></div>
            <div className="row" style={{flexWrap:'wrap',gap:'8px'}}>{banned.length===0&&<div className="muted tiny">–ü—É—Å—Ç–æ</div>}{banned.map(w=><div key={w} className="badge">{w} <button className="btn tiny ghost" style={{marginLeft:'6px',padding:'2px 6px'}} onClick={()=>delBan(w)}>—É–¥–∞–ª–∏—Ç—å</button></div>)}</div>
          </div></div>
        </>}
      </div>;
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  </script>
<script>
// --- TEMP: show detected user at bottom-left (can be removed later) ---
(function(){
  try {
    var info = document.getElementById("__tg_user_info__");
    if (!info) {
      info = document.createElement("div");
      info.id = "__tg_user_info__";
      info.style.position = "fixed";
      info.style.bottom = "10px";
      info.style.left = "10px";
      info.style.background = "rgba(0,0,0,0.55)";
      info.style.color = "#f0b85a";
      info.style.fontSize = "12px";
      info.style.padding = "6px 10px";
      info.style.borderRadius = "8px";
      info.style.zIndex = "9999";
      info.style.pointerEvents = "none";
      info.textContent = "Telegram ID: " + CURRENT_USER_ID + " | Admin: " + IS_ADMIN + " | Name: " + CURRENT_USER_NAME;
      document.body.appendChild(info);
    }
  } catch(e){}
})();
// ---------------------------------------------------------------------
</script>
</body>
</html>