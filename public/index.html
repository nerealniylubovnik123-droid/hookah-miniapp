<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hookah MiniApp</title>
  <!-- ‚úÖ –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      background: #000;
      color: #f0e9db;
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
    }
    .center {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
      font-size: 1.1rem;
      color: #f0e9db;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <!-- –°–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ –≤ Telegram -->
  <div id="telegram-check" class="center hidden">
    ‚ùó –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Mini App (–±–æ—Ç–∞)
  </div>

  <!-- React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
  <div id="root" class="hidden"></div>

  <script>
    // === Telegram Auth before React ===
    function getTelegramUser() {
      try {
        const tg = window.Telegram?.WebApp;
        if (tg?.initDataUnsafe?.user) {
          const u = tg.initDataUnsafe.user;
          const fullName = [u.first_name, u.last_name].filter(Boolean).join(" ") || u.username || `User ${u.id}`;
          return { id: String(u.id), username: u.username || "no_username", name: fullName };
        }
      } catch (e) { console.warn("Telegram SDK error:", e); }
      return null;
    }

    const user = getTelegramUser();
    const isTelegram = !!window.Telegram?.WebApp;
    const isAdmin = user?.username === "Tutenhaman";

    if (!isTelegram || !user) {
      // –ù–µ –≤ Telegram ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
      document.getElementById("telegram-check").classList.remove("hidden");
    } else {
      // Telegram –Ω–∞–π–¥–µ–Ω ‚Üí –ø–µ—Ä–µ–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ –≤ React
      document.getElementById("root").classList.remove("hidden");
      window.HOOKAH_USER = user;
      window.HOOKAH_IS_ADMIN = isAdmin;
      // –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ–¥–∫–ª—é—á–∞–µ–º React
      loadReactApp();
    }

    function loadReactApp() {
      const scriptReact = document.createElement("script");
      scriptReact.src = "https://unpkg.com/react@18/umd/react.development.js";
      const scriptDOM = document.createElement("script");
      scriptDOM.src = "https://unpkg.com/react-dom@18/umd/react-dom.development.js";
      const scriptBabel = document.createElement("script");
      scriptBabel.src = "https://unpkg.com/@babel/standalone/babel.min.js";

      document.body.append(scriptReact, scriptDOM, scriptBabel);

      scriptBabel.onload = () => {
        const appScript = document.createElement("script");
        appScript.type = "text/babel";
        appScript.textContent = `
          const { useState } = React;
          function App() {
            const user = window.HOOKAH_USER;
            const isAdmin = window.HOOKAH_IS_ADMIN;
            const [tab, setTab] = useState("mixes");

            return (
              <div style={{maxWidth:"420px",margin:"0 auto",padding:"16px"}}>
                <h2 style={{textAlign:"center",color:"#f0b85a"}}>–ö–∞–ª—å—è–Ω–Ω—ã–π –º–∏–∫—Å–µ—Ä</h2>
                <div style={{textAlign:"center",fontSize:"0.9rem",opacity:0.8,marginBottom:"12px"}}>
                  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user.name} {isAdmin ? "‚≠ê" : ""}
                </div>
                <div style={{display:"flex",justifyContent:"space-around",marginBottom:"16px"}}>
                  <button onClick={()=>setTab("mixes")} style={tab==="mixes"?{background:"#f0b85a",color:"#000"}:{background:"#151515",color:"#fff"}}>–ú–∏–∫—Å—ã</button>
                  <button onClick={()=>setTab("builder")} style={tab==="builder"?{background:"#f0b85a",color:"#000"}:{background:"#151515",color:"#fff"}}>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</button>
                  {isAdmin && <button onClick={()=>setTab("admin")} style={tab==="admin"?{background:"#f0b85a",color:"#000"}:{background:"#151515",color:"#fff"}}>–ê–¥–º–∏–Ω</button>}
                </div>

                {tab==="mixes" && <div>üì¶ –†–∞–∑–¥–µ–ª –º–∏–∫—Å–æ–≤ –≥–æ—Å—Ç–µ–π. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –º–∏–∫—Å—ã.</div>}
                {tab==="builder" && <div>üß© –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –º–∏–∫—Å–æ–≤. –í—ã–±–æ—Ä –±—Ä–µ–Ω–¥–æ–≤ –∏ –≤–∫—É—Å–æ–≤, —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–∫—Å–æ–≤.</div>}
                {tab==="admin" && isAdmin && <div>‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–µ–Ω–¥–∞–º–∏, –≤–∫—É—Å–∞–º–∏ –∏ –∑–∞–ø—Ä–µ—Ç–∞–º–∏.</div>}
              </div>
            );
          }

          ReactDOM.createRoot(document.getElementById("root")).render(<App />);
        `;
        document.body.append(appScript);
      };
    }
  </script>
</body>
</html>
